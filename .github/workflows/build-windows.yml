name: Build C Program for Windows

on:
  push:
    branches:
      - main  # Trigger the workflow on 'main' branch
  pull_request:
    branches:
      - main  # Trigger workflow on PRs to 'main'

jobs:
  build:
    runs-on: windows-latest  # Use the Windows runner to compile for Windows

    steps:
    - name: Checkout code
      uses: actions/checkout@v2  # Checkout your code from GitHub

    - name: Install MSYS2 and dependencies
      run: |
        choco install msys2
        refreshenv  # Refresh environment variables
        pacman -Syu  # Update the system
        pacman -S mingw-w64-x86_64-curl mingw-w64-x86_64-zlib mingw-w64-x86_64-json-c  # Install libraries

    - name: Set up MSYS2 environment
      run: |
        echo "C:/msys64/mingw64/bin" >> $GITHUB_ENV  # Add MSYS2 binaries to path

    - name: Build the program
      run: |
        mingw32-make  # Use mingw32-make (Windows-compatible Make)

    - name: Upload .exe artifact
      uses: actions/upload-artifact@v4  # Upload the artifact
      with:
        name: bit.exe
        path: bit.exe
